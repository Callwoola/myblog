<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Mongodb | stay hungry stay foolish]]></title>
  <link href="http://blog.woola.net//blog/categories/mongodb/atom.xml" rel="self"/>
  <link href="http://blog.woola.net//"/>
<<<<<<< HEAD
  <updated>2015-12-06T14:21:37+08:00</updated>
=======
  <updated>2015-08-26T21:40:45+08:00</updated>
>>>>>>> ec3179fcb70603be5f06cd72f8bf544ad4c0e7fd
  <id>http://blog.woola.net//</id>
  <author>
    <name><![CDATA[Neo]]></name>
    <email><![CDATA[call@woola.net]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Mongodb 速度成法]]></title>
    <link href="http://blog.woola.net//blog/2014/05/05/mongodb_php_python/"/>
    <updated>2014-05-05T22:57:40+08:00</updated>
    <id>http://blog.woola.net//blog/2014/05/05/mongodb_php_python</id>
    <content type="html"><![CDATA[<p>mongo的优点就不说了，我觉得在我认证范围内的业务大部分可以用mongo,这里也主要介绍python 和php的安装和使用</p>

<p>根据自己的系统选择 解压后在bin里面 有很多个工具</p>

<ul>
<li><p>Mongod.exe 是用来连接到mongo数据库服务器的，即服务器端。</p></li>
<li><p>Mongo.exe 是用来启动</p></li>
<li><p>MongoDB shell的，即客户端。</p></li>
</ul>


<p>其他文件:</p>

<ul>
<li><p>mongodump 逻辑备份工具。</p></li>
<li><p>mongorestore 逻辑恢复工具。</p></li>
<li><p>mongoexport 数据导出工具。</p></li>
<li><p>mongoimport 数据导入工具。</p></li>
</ul>


<p><code>启动 X:/X/bin/mongod.exe  --dbpath=x:/x/data/db</code></p>

<p>(例如)
dbpath 是自动的数据库存放位置</p>

<p>好了那么现在我们就可以进入客户端了</p>

<pre><code class="java">&gt;mongo.exe    
</code></pre>

<p> 4.2）创建collection并插入数据</p>

<p> 在传统关系型数据库中，创建完了库后接下来会创建表，但是在mongoDB中没有“表”的概念，与其对应的一个概念是集合，即collection。</p>

<p> 在shell 命令窗口键入如下命令：</p>

<pre><code class="java">&gt; db.users.insert({'name':'xumingxiang','sex':'man'}) // 这条命令是向users 集合中插入一条数据。如果集合users不存在，则会先新建一个，然后再插入数据，参数以JSON格式传入。
</code></pre>

<p>因为我们后面要测试删除数据，所以我们再插入一条数据：</p>

<pre><code class="java">db.users.insert({'name':xiangshu','sex':'man'})
4.3）
//在上面4.1）和4.2）我们创建了数据库，创建了集合，还插入了两条数据，那么这些操作有没有执行成功呢？我们来查询一下：
</code></pre>

<p>在shell 命令窗口键入如下命令：</p>

<pre><code class="java">&gt;show dbs // 显示所有数据库  
&gt;show collections // 显示当前数据库下的所有集合  
&gt;db.users.find() // 显示users集合下的所有数据文档
</code></pre>

<p> 看我用红色标记的部分。这说明我们之前的操作是成功的。我们还看到系统给每条记录分配了一个惟一主键 _id 。</p>

<p>4.4）更新数据</p>

<p> 现在我们要把第二条数据的sex改成女即“women”</p>

<pre><code class="java">
&gt; db.users.update({'name':'xiangshu'},{'$set':{'sex':'women'}},upsert=true,multi=false)
</code></pre>

<p> 解释一下几个参数：</p>

<p> 第一：查询的条件</p>

<p> 第二：更新的字段</p>

<p> 第三：如果不存在则插入</p>

<p> 第四：是否允许修改多条记录</p>

<p>4.5)删除记录</p>

<p> 我们现在要把第一条记录即'name'为'xumingxiang'的</p>

<pre><code class="java"> &gt; db. users.remove({'name':'xumingxiang'})
 我们在检验一下4）5）两步有没有操作成功，在shell 命令窗口键入如下命令：

 &gt; db.users.find() 
</code></pre>

<p> 从输出的界面我们看到现在只剩下一条'name'为'xiangshu'的了，并且它的'sex'为'women'，这说明4）5)两步操作成功了。</p>

<p> 4.6）删除所有记录</p>

<pre><code class="java">&gt; db.users.remove()
</code></pre>

<p> 4.7) 删除collection</p>

<pre><code class="java">&gt; db.users.drop() //如果删除成功会返回“true”，否则返回“false”
</code></pre>

<p>4.8）删除当前数据库</p>

<pre><code class="java">&gt; db.dropDatabase()
</code></pre>

<p>mongo 相关命令</p>

<pre><code class="java">db.AddUser(username,password)  添加用户

db.auth(usrename,password)     设置数据库连接验证

db.cloneDataBase(fromhost)     从目标服务器克隆一个数据库
db.commandHelp(name)           returns the help for the command
db.copyDatabase(fromdb,todb,fromhost)  复制数据库fromdb---源数据库名称，todb---目标数据库名称，fromhost---源数据库服务器地址
db.createCollection(name,{size:3333,capped:333,max:88888})  创建一个数据集，相当于一个表
db.currentOp()                 取消当前库的当前操作
db.dropDataBase()              删除当前数据库
db.eval(func,args)             run code server-side
db.getCollection(cname)        取得一个数据集合，同用法：db['cname'] or
db.getCollenctionNames()       取得所有数据集合的名称列表
db.getLastError()              返回最后一个错误的提示消息
db.getLastErrorObj()           返回最后一个错误的对象
db.getMongo()                  取得当前服务器的连接对象get the server
db.getMondo().setSlaveOk()     allow this connection to read from then nonmaster membr of a replica pair
db.getName()                   返回当操作数据库的名称
db.getPrevError()              返回上一个错误对象
db.getProfilingLevel()         
db.getReplicationInfo()        获得重复的数据
db.getSisterDB(name)           get the db at the same server as this onew
db.killOp()                    停止（杀死）在当前库的当前操作
db.printCollectionStats()      返回当前库的数据集状态
db.printReplicationInfo()
db.printSlaveReplicationInfo()
db.printShardingStatus()       返回当前数据库是否为共享数据库
db.removeUser(username)        删除用户
db.repairDatabase()            修复当前数据库
db.resetError()                
db.runCommand(cmdObj)          run a database command. if cmdObj is a string, turns it into {cmdObj:1}
db.setProfilingLevel(level)    0=off,1=slow,2=all
db.shutdownServer()            关闭当前服务程序
db.version()                   返回当前程序的版本信息
</code></pre>

<pre><code class="java">db.test.find({id:10})          返回test数据集ID=10的数据集
db.test.find({id:10}).count()  返回test数据集ID=10的数据总数
db.test.find({id:10}).limit(2) 返回test数据集ID=10的数据集从第二条开始的数据集
db.test.find({id:10}).skip(8)  返回test数据集ID=10的数据集从0到第八条的数据集
db.test.find({id:10}).limit(2).skip(8)  返回test数据集ID=1=的数据集从第二条到第八条的数据
db.test.find({id:10}).sort()   返回test数据集ID=10的排序数据集
db.test.findOne([query])       返回符合条件的一条数据
db.test.getDB()                返回此数据集所属的数据库名称
db.test.getIndexes()           返回些数据集的索引信息
db.test.group({key:...,initial:...,reduce:...[,cond:...]})
db.test.mapReduce(mayFunction,reduceFunction,&lt;optional params&gt;)
db.test.remove(query)                      在数据集中删除一条数据
db.test.renameCollection(newName)          重命名些数据集名称
db.test.save(obj)                          往数据集中插入一条数据
db.test.stats()                            返回此数据集的状态
db.test.storageSize()                      返回此数据集的存储大小
db.test.totalIndexSize()                   返回此数据集的索引文件大小
db.test.totalSize()                        返回些数据集的总大小
db.test.update(query,object[,upsert_bool]) 在此数据集中更新一条数据
db.test.validate()                         验证此数据集
db.test.getShardVersion()                  返回数据集共享版本号
</code></pre>

<p>与sql语法比较</p>

<table>
<thead>
<tr>
<th> MongoDB语法   </th>
<th> MySql语法 </th>
</tr>
</thead>
<tbody>
<tr>
<td>db.test.find({&lsquo;name&rsquo;:&lsquo;foobar&rsquo;}) </td>
<td> select * from test where name=&lsquo;foobar&rsquo;</td>
</tr>
<tr>
<td>db.test.find()                  </td>
<td> select * from test</td>
</tr>
<tr>
<td>db.test.find({&lsquo;ID&rsquo;:10}).count() </td>
<td>select count(*) from test where ID=10</td>
</tr>
<tr>
<td>db.test.find().skip(10).limit(20)     </td>
<td>select * from test limit 10,20</td>
</tr>
<tr>
<td>db.test.find({&lsquo;ID&rsquo;:{$in:[25,35,45]}}) </td>
<td>select * from test where ID in (25,35,45)</td>
</tr>
<tr>
<td>db.test.find().sort({&lsquo;ID&rsquo;:-1})        </td>
<td>select * from test order by ID desc</td>
</tr>
<tr>
<td>db.test.distinct(&lsquo;name&rsquo;,{&lsquo;ID&rsquo;:{$lt:20}})  </td>
<td>select distinct(name) from test where ID&lt;20</td>
</tr>
<tr>
<td>db.test.group({key:{&lsquo;name&rsquo;:true},cond:{&lsquo;name&rsquo;:&lsquo;foo&rsquo;},reduce:function(obj,prev){prev.msum+=obj.marks;},initial:{msum:0}})  </td>
<td>select name,sum(marks) from test group by name</td>
</tr>
<tr>
<td>db.test.find(&lsquo;this.ID&lt;20&rsquo;,{name:1})  </td>
<td>select name from test where ID&lt;20</td>
</tr>
<tr>
<td>db.test.insert({&lsquo;name&rsquo;:&lsquo;foobar&rsquo;,&lsquo;age&rsquo;:25})&lt;==>insert into test (&lsquo;name&rsquo;,&lsquo;age&rsquo;) values(&lsquo;foobar&rsquo;,25)</td>
<td></td>
</tr>
<tr>
<td>db.test.remove({})                </td>
<td>delete * from test</td>
</tr>
<tr>
<td>db.test.remove({&lsquo;age&rsquo;:20})        </td>
<td>delete test where age=20</td>
</tr>
<tr>
<td>db.test.remove({&lsquo;age&rsquo;:{$lt:20}})  </td>
<td>elete test where age&lt;20</td>
</tr>
<tr>
<td>db.test.remove({&lsquo;age&rsquo;:{$lte:20}}) </td>
<td>delete test where age&lt;=20</td>
</tr>
<tr>
<td>db.test.remove({&lsquo;age&rsquo;:{$gt:20}})  </td>
<td>delete test where age>20</td>
</tr>
<tr>
<td>db.test.remove({&lsquo;age&rsquo;:{$gte:20}}) </td>
<td>delete test where age>=20</td>
</tr>
<tr>
<td>db.test.remove({&lsquo;age&rsquo;:{$ne:20}})  </td>
<td>delete test where age!=20</td>
</tr>
<tr>
<td>db.test.update({&lsquo;name&rsquo;:&lsquo;foobar&rsquo;},{$set:{&lsquo;age&rsquo;:36}}) </td>
<td>update test set age=36 where name=&lsquo;foobar&rsquo;</td>
</tr>
</tbody>
</table>


<p>可视化的客户端管理工具MongoVUE</p>

<p>使用mongo.exe 管理数据库虽然可行，功能也挺强大，但每次都要敲命令，即繁琐枯燥而且效率低下。下面介绍一款Windows下的可视化操作的管理工具MongoVUE</p>

<p><a href="http://www.mongovue.com/downloads/">下载地址：</a></p>
]]></content>
  </entry>
  
</feed>
